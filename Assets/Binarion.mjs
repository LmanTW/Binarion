var e=class{static getMaxIntegerValue(e){let t=0;for(let r=0;r<8*e-1;r++)t+=0==t?2:t;return t}static getIntegerByteLength(e,t){if(e<=r)return 1;if(e<=n)return 2;if(e<=a)return 3;if(e<=g)return 4;if(e<=i)return 5;if(e<=o)return 6;if(e<=y)return 7;if(e<=d)return 8;throw new Error(`Integer Out Of Range: ${t?`-${e}`:e}`)}static writeInteger(e,t,r,n){let a=!1;r<0&&(r=-r,a=!0);for(let a=0;a<n;a++)e[t]=r>>8*a&255,t++;a&&(e[t-1]|=128)}static readInteger(e,t,r){let n=0;for(let a=0;a<r;a++)a===r-1&&(128&e[t])>>7==1?(e[t]&=127,n|=e[t]<<8*a,n=-n):n|=e[t]<<8*a,t++;return n}static integersToByte(e,t){return e<<4|t}static byteToIntegers(e){return[e>>4&15,15&e]}},t=e,r=e.getMaxIntegerValue(1),n=e.getMaxIntegerValue(2),a=e.getMaxIntegerValue(3),g=e.getMaxIntegerValue(4),i=e.getMaxIntegerValue(5),o=e.getMaxIntegerValue(6),y=e.getMaxIntegerValue(7),d=e.getMaxIntegerValue(8);import s from"util";var l,u=class{static getStringByteLength(e){let r=0,n=0;for(let a=0;a<e.length;a++){const g=t.getIntegerByteLength(e.charCodeAt(a),!1);g!==n&&(n=g,r++),r+=g}return r}static writeString(e,r,n){let a=0;for(let g=0;g<n.length;g++){const i=n.charCodeAt(g),o=t.getIntegerByteLength(i,!1);o!==a&&(a=o,t.writeInteger(e,r,-o,1),r++),t.writeInteger(e,r,i,a),r+=a}}static readString(e,r,n){let a="",g=0;for(;r<n;){const n=t.readInteger(e,r,1);n<0?(g=-n,r++):(a+=String.fromCharCode(t.readInteger(e,r,g)),r+=g)}return a}static stringToBytes(e,r){const n=new Uint8Array(r);let a=0,g=0;for(let r=0;r<e.length;r++){const i=e.charCodeAt(r),o=t.getIntegerByteLength(i,!1);o!==a&&(a=o,t.writeInteger(n,g,o,1),g++),t.writeInteger(n,g,i,a),g+=a}return n}};(e=>{let r;var n;let a;var g;(n=r=e.TypesID||(e.TypesID={}))[n.Null=0]="Null",n[n.Undefined=1]="Undefined",n[n.Boolean=2]="Boolean",n[n.Integer=3]="Integer",n[n.Float=4]="Float",n[n.String=5]="String",n[n.Array=6]="Array",n[n.Uint8Array=7]="Uint8Array",n[n.Uint16Array=8]="Uint16Array",n[n.Uint32Array=9]="Uint32Array",n[n.Object=11]="Object",n[n.Map=12]="Map",n[n.Set=13]="Set",n[n.Function=14]="Function",(g=a=e.Types||(e.Types={})).NullType={id:0,getBodyLength:()=>0,writeBody:()=>{},readBody:()=>null},g.UndefinedType={id:1,getBodyLength:()=>0,writeBody:()=>{},readBody:()=>{}},g.BooleanType={id:2,getBodyLength:()=>1,writeBody:(e,t,r)=>e[t]=r?1:0,readBody:(e,t)=>1===e[t]},g.IntegerType={id:3,getBodyLength:e=>t.getIntegerByteLength(e<0?-e:e,e<0),writeBody:(e,r,n,a)=>t.writeInteger(e,r,n,a),readBody:(e,r,n)=>t.readInteger(e,r,n-r)},g.StringType={id:5,getBodyLength:e=>u.getStringByteLength(e),writeBody:(e,t,r)=>u.writeString(e,t,r),readBody:(e,t,r)=>u.readString(e,t,r)},g.ArrayType={id:6,getBodyLength:e=>{let t=0;for(let r=0;r<e.length;r++)t+=h.getFragmentLength(e[r]);return t},writeBody:(e,t,r)=>r.forEach((r=>t=h.writeFragment(e,t,r))),readBody:(e,t,r)=>{let n=new Array;for(;t<r;){const r=h.readFragment(e,t);n.push(r.data),t=r.offset}return n}},g.Uint8ArrayType={id:7,getBodyLength:e=>e.length,writeBody:(e,t,r)=>e.set(r,t),readBody:(e,t,r)=>e.subarray(t,r)},g.Uint16ArrayType={id:8,getBodyLength:e=>2*e.length,writeBody:(e,r,n)=>{for(let a=0;a<n.length;a++)t.writeInteger(e,r,n[a],2),r+=2},readBody:(e,r,n)=>{const a=new Uint16Array((n-r)/2);for(let n=0;n<a.length;n++)a[n]=t.readInteger(e,r,2),r+=2;return a}},g.Uint32ArrayType={id:9,getBodyLength:e=>4*e.length,writeBody:(e,r,n)=>{for(let a=0;a<n.length;a++)t.writeInteger(e,r,n[a],42),r+=2},readBody:(e,r,n)=>{const a=new Uint32Array((n-r)/4);for(let n=0;n<a.length;n++)a[n]=t.readInteger(e,r,4),r+=2;return a}},g.ObjectType={id:11,getBodyLength:e=>{let t=0;for(let r of Object.keys(e))t+=h.getFragmentLength(r)+h.getFragmentLength(e[r]);return t},writeBody:(e,t,r)=>{for(let n of Object.keys(r))t=h.writeFragment(e,t,n),t=h.writeFragment(e,t,r[n])},readBody:(e,t,r)=>{const n={};for(;t<r;){const r=h.readFragment(e,t);t=r.offset;const a=h.readFragment(e,t);t=a.offset,n[r.data]=a.data}return n}},e.getDataTypeID=function(e){if(null===e)return 0;if(void 0===e)return 1;if("boolean"==typeof e)return 2;if("number"==typeof e&&!Number.isNaN(e))return Number.isInteger(e)?3:4;if("string"==typeof e)return 5;if(Array.isArray(e))return 6;if(e instanceof Uint8Array)return 7;if(e instanceof Uint16Array)return 8;if(e instanceof Object)return 11;throw new Error(`Unsupported Data Type: <${typeof e}> ([34m${s.inspect(e)}[0m)`)},e.getDataType=function(t){for(let r in e.Types)if(e.Types[r].id===t)return e.Types[r];throw new Error(`Data Type Not Found: ${t}`)}})(l||(l={}));var f=l,h=class{static getFragmentLength(e){const t=f.getDataTypeID(e),r=f.getDataType(t).getBodyLength(e);return this.getHeaderLength(r)+r}static getHeaderLength(e){return 1+t.getIntegerByteLength(e,!1)}static writeFragment(e,t,r){const n=f.getDataTypeID(r),a=f.getDataType(n),g=a.getBodyLength(r);return t=this.writeHeader(e,t,{dataTypeID:n,bodyLength:g}),a.writeBody(e,t,r,g),t+g}static writeHeader(e,r,n){const a=t.getIntegerByteLength(n.bodyLength,!1);return e[r]=t.integersToByte(n.dataTypeID,a),t.writeInteger(e,r+1,n.bodyLength,a),r+(1+a)}static readFragment(e,r){const[n,a]=t.byteToIntegers(e[r]),g=t.readInteger(e,r+1,a);return{offset:(r+=1+a)+g,data:f.getDataType(n).readBody(e,r,r+g)}}},c={save:e=>{const t=new Uint8Array(h.getFragmentLength(e));return h.writeFragment(t,0,e),t},load:e=>h.readFragment(e,0).data};export{c as default};