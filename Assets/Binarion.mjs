var DataFormat,Nibble_default=class{static writeNibble(t,e,a){t.writeByte(e<<4|a)}static readNibble(t){const e=t.readByte();return[e>>4&15,15&e]}};import util from"util";(t=>{let e;var a;(a=e=t.ID||(t.ID={}))[a.None=0]="None",a[a.Boolean=1]="Boolean",a[a.Integer=2]="Integer",a[a.Float=3]="Float",a[a.String=4]="String",a[a.Array=5]="Array",a[a.UintArray=7]="UintArray",a[a.Object=11]="Object",a[a.Map=12]="Map",a[a.Set=13]="Set",a[a.Function=14]="Function"})(DataFormat||(DataFormat={}));var Data,DataFormat_default=DataFormat,Integer=class t{static getMaxIntegerValue(t){if(0===t)return 0;let e=0;for(let a=0;a<7*t;a++)e+=0===e?2:e;return e}static getIntegerByteLength(e){const a=e<0?-e:e;for(let e=0;e<16;e++)if(a<t.getMaxIntegerValue(e))return e;throw new Error(`Integer Out Of Range: ${e}`)}static writeInteger(t,e,a){for(let r=0;r<a;r++){let n=BigInt(e)>>BigInt(7*r)&0b01111111n;r===a-1&&(n|=0b10000000n),t.writeByte(Number(n))}}static readInteger(t){let e=0n,a=0;for(;;){let r=t.readByte();if(r>>7==1){e|=(0b01111111n&BigInt(r))<<BigInt(a);break}e|=BigInt(r)<<BigInt(a),a+=7}return Number(e)}},Integer_default=Integer,DataFormat_UintArray={id:DataFormat_default.ID.UintArray,getHeaderAttachemnt:t=>t instanceof Uint16Array?2:t instanceof Uint32Array?4:t instanceof BigUint64Array?8:1,getBodyInfo:t=>{let e=Integer_default.getIntegerByteLength(t.length),a=1;return t instanceof Uint16Array&&(a=2),t instanceof Uint32Array&&(a=4),t instanceof BigUint64Array&&(a=8),{bodyLength:e+t.length*a,integerByteLength:e,elementByteLength:a}},writeBody:(t,e,a)=>{if(Integer_default.writeInteger(t,e.length,a.integerByteLength),e instanceof Uint8Array)t.writeBytes(e);else for(let r=0;r<e.length;r++)for(let n=8*(a.elementByteLength-1);n>=0;n-=8)t.writeByte(e[r]>>n&255)},readBody:(t,e)=>{const a=Integer_default.readInteger(t);if(1===e)return t.readBytes(a);{let r;if(e<=2)r=new Uint16Array(a);else{if(!(e<=4))throw new Error(`Element Byte Length Out Of Range: ${e}`);r=new Uint32Array(a)}for(let n=0;n<a;n++)for(let a=8*(e-1);a>=0;a-=8)r[n]|=t.readByte()<<a;return r}}},UintArray_default=DataFormat_UintArray,DataFormat_Boolean={id:DataFormat_default.ID.Boolean,getHeaderAttachemnt:t=>t?1:0,getBodyInfo:()=>({bodyLength:0}),writeBody:()=>{},readBody:(t,e)=>1===e},Boolean_default=DataFormat_Boolean,DataFormat_Integer={id:DataFormat_default.ID.Integer,getHeaderAttachemnt:t=>t<0?1:0,getBodyInfo:t=>({bodyLength:Integer_default.getIntegerByteLength(t)}),writeBody:(t,e,a)=>Integer_default.writeInteger(t,e<0?-e:e,a.bodyLength),readBody:(t,e)=>{const a=Integer_default.readInteger(t);return 1===e?-a:a}},Integer_default2=DataFormat_Integer,String_default=class{static getStringByteLength(t){let e=0;for(let a=0;a<t.length;a++)e+=Integer_default.getIntegerByteLength(t.charCodeAt(a));return Integer_default.getIntegerByteLength(t.length)+e}static writeString(t,e){const a=e.length;Integer_default.writeInteger(t,a,Integer_default.getIntegerByteLength(a));for(let a=0;a<e.length;a++){const r=e.charCodeAt(a);Integer_default.writeInteger(t,r,Integer_default.getIntegerByteLength(r))}}static readString(t){let e="";const a=Integer_default.readInteger(t);for(let r=0;r<a;r++)e+=String.fromCharCode(Number(Integer_default.readInteger(t)));return e}},DataFormat_String={id:DataFormat_default.ID.String,getHeaderAttachemnt:()=>0,getBodyInfo:t=>({bodyLength:String_default.getStringByteLength(t)}),writeBody:(t,e)=>String_default.writeString(t,e),readBody:t=>String_default.readString(t)},String_default2=DataFormat_String,DataFormat_Object={id:DataFormat_default.ID.Object,getHeaderAttachemnt:()=>0,getBodyInfo:t=>{let e=0;const a=Object.keys(t);for(let r of a)e+=String_default.getStringByteLength(r),e+=Fragment_default.getFragmentByteLength(t[r]);return{bodyLength:Integer_default.getIntegerByteLength(a.length)+e}},writeBody:(t,e)=>{const a=Object.keys(e);Integer_default.writeInteger(t,a.length,Integer_default.getIntegerByteLength(a.length));for(let r of a)String_default.writeString(t,r),Fragment_default.writeFragment(t,e[r])},readBody:t=>{const e={},a=Integer_default.readInteger(t);for(let r=0;r<a;r++)e[String_default.readString(t)]=Fragment_default.readFragment(t);return e}},Object_default=DataFormat_Object,DataFormat_Array={id:DataFormat_default.ID.Array,getHeaderAttachemnt:()=>0,getBodyInfo:t=>{let e=0;for(let a of t)e+=Fragment_default.getFragmentByteLength(a);const a=Integer_default.getIntegerByteLength(t.length);return{bodyLength:a+e,integerByteLength:a}},writeBody:(t,e,a)=>{Integer_default.writeInteger(t,e.length,a.integerByteLength);for(let a of e)Fragment_default.writeFragment(t,a)},readBody:t=>{const e=Integer_default.readInteger(t),a=[];for(let r=0;r<e;r++)a.push(Fragment_default.readFragment(t));return a}},Array_default=DataFormat_Array,DataFormat_None={id:DataFormat_default.ID.None,getHeaderAttachemnt:t=>null===t?0:1,getBodyInfo:()=>({bodyLength:0}),writeBody:()=>{},readBody:(t,e)=>{if(console.log(e),0===e)return null}},None_default=DataFormat_None,DataFormat_Set={id:DataFormat_default.ID.Set,getHeaderAttachemnt:()=>0,getBodyInfo:t=>{let e=0;const a=t.keys();for(;;){const t=a.next();if(e+=Fragment_default.getFragmentByteLength(t.value),t.done)break}return{bodyLength:Integer_default.getIntegerByteLength(t.size)+e}},writeBody:(t,e)=>{Integer_default.writeInteger(t,e.size,Integer_default.getIntegerByteLength(e.size));const a=e.keys();for(;;){const e=a.next();if(Fragment_default.writeFragment(t,e.value),e.done)break}},readBody:t=>{const e=new Set,a=Integer_default.readInteger(t);for(let r=0;r<a;r++)e.add(Fragment_default.readFragment(t));return e}},Set_default=DataFormat_Set,DataFormat_Map={id:DataFormat_default.ID.Map,getHeaderAttachemnt:()=>0,getBodyInfo:t=>{let e=0;const a=t.keys();for(;;){const r=a.next();if(void 0!==r.value&&(e+=String_default.getStringByteLength(r.value),e+=Fragment_default.getFragmentByteLength(t.get(r.value))),r.done)break}return{bodyLength:Integer_default.getIntegerByteLength(t.size)+e}},writeBody:(t,e)=>{Integer_default.writeInteger(t,e.size,Integer_default.getIntegerByteLength(e.size));const a=e.keys();for(;;){const r=a.next();if(void 0!==r.value&&(String_default.writeString(t,r.value),Fragment_default.writeFragment(t,e.get(r.value))),r.done)break}},readBody(t){const e=new Map,a=Integer_default.readInteger(t);for(let r=0;r<a;r++)e.set(String_default.readString(t),Fragment_default.readFragment(t));return e}},Map_default=DataFormat_Map;(t=>{t.Writer=class{_index=0;_bytes;constructor(t){this._bytes=t,this._bytes.set}get index(){return this._index}get bytes(){return this._bytes}writeByte(t){this._bytes[this._index]=t,this._index++}writeBytes(t){this._bytes.set(t,this._index),this._index+=t.length}};t.Reader=class{_index=0;_bytes;constructor(t){this._bytes=t,this._bytes.set}get index(){return this._index}get bytes(){return this._bytes}readByte(){const t=this._bytes[this._index];return this._index++,t}readBytes(t){const e=this._bytes.subarray(this._index,this._index+t);return this._index+=t,e}},t.Formats=[UintArray_default,Boolean_default,Integer_default2,String_default2,Object_default,Array_default,None_default,Set_default,Map_default],t.getDataFormatID=function(t){if(null==t)return DataFormat_default.ID.None;if("boolean"==typeof t)return DataFormat_default.ID.Boolean;if("number"==typeof t&&!Number.isNaN(t))return Number.isInteger(t)?DataFormat_default.ID.Integer:DataFormat_default.ID.Float;if("string"==typeof t)return DataFormat_default.ID.String;if(Array.isArray(t))return DataFormat_default.ID.Array;if(t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof BigUint64Array)return DataFormat_default.ID.UintArray;if(t instanceof Set)return DataFormat_default.ID.Set;if(t instanceof Map)return DataFormat_default.ID.Map;if(t instanceof Object)return DataFormat_default.ID.Object;throw new Error(`Unsupported Data Format: <${typeof t}> ([34m${util.inspect(t)}[0m)`)},t.getDataFormat=function(e){for(let a of t.Formats)if(a.id===e)return a;throw new Error(`Data Format Not Found: "${e}"`)}})(Data||(Data={}));var Binarion,Data_default=Data,Fragment_default=class{static getFragmentByteLength(t){const e=Data_default.getDataFormatID(t);return 1+Data_default.getDataFormat(e).getBodyInfo(t).bodyLength}static writeFragment(t,e){const a=Data_default.getDataFormatID(e),r=Data_default.getDataFormat(a),n=r.getBodyInfo(e);this.writeHeader(t,{dataFormatID:a,attachment:r.getHeaderAttachemnt(e)}),r.writeBody(t,e,n)}static writeHeader(t,e){Nibble_default.writeNibble(t,e.dataFormatID,e.attachment)}static readFragment(t){const[e,a]=Nibble_default.readNibble(t);return Data_default.getDataFormat(e).readBody(t,a)}};(t=>{t.save=function(t){const e=new Uint8Array(Fragment_default.getFragmentByteLength(t)),a=new Data_default.Writer(e);return Fragment_default.writeFragment(a,t),e},t.load=function(t){const e=new Data_default.Reader(t);return Fragment_default.readFragment(e)}})(Binarion||(Binarion={}));var API_default=Binarion;export{API_default as default};