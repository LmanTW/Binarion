"use strict";var __create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(e,t)=>{for(var r in t)__defProp(e,r,{get:t[r],enumerable:!0})},__copyProps=(e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of __getOwnPropNames(t))__hasOwnProp.call(e,a)||a===r||__defProp(e,a,{get:()=>t[a],enumerable:!(n=__getOwnPropDesc(t,a))||n.enumerable});return e},__toESM=(e,t,r)=>(r=null!=e?__create(__getProtoOf(e)):{},__copyProps(!t&&e&&e.__esModule?r:__defProp(r,"default",{value:e,enumerable:!0}),e)),__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),API_exports={};__export(API_exports,{default:()=>API_default}),module.exports=__toCommonJS(API_exports);var Data,Integer=class{static getMaxIntegerValue(e){let t=0;for(let r=0;r<8*e-1;r++)t+=0==t?2:t;return t}static getIntegerByteLength(e,t){if(e<=MaxInteger_1Byte)return 1;if(e<=MaxInteger_2Byte)return 2;if(e<=MaxInteger_3Byte)return 3;if(e<=MaxInteger_4Byte)return 4;if(e<=MaxInteger_5Byte)return 5;if(e<=MaxInteger_6Byte)return 6;if(e<=MaxInteger_7Byte)return 7;if(e<=MaxInteger_8Byte)return 8;throw new Error(`Integer Out Of Range: ${t?`-${e}`:e}`)}static writeInteger(e,t,r,n){let a=!1;r<0&&(r=-r,a=!0);for(let a=0;a<n;a++)e[t]=r>>8*a&255,t++;a&&(e[t-1]|=128)}static readInteger(e,t,r){let n=0;for(let a=0;a<r;a++)a===r-1&&(128&e[t])>>7==1?(e[t]&=127,n|=e[t]<<8*a,n=-n):n|=e[t]<<8*a,t++;return n}static integersToByte(e,t){return e<<4|t}static byteToIntegers(e){return[e>>4&15,15&e]}},Integer_default=Integer,MaxInteger_1Byte=Integer.getMaxIntegerValue(1),MaxInteger_2Byte=Integer.getMaxIntegerValue(2),MaxInteger_3Byte=Integer.getMaxIntegerValue(3),MaxInteger_4Byte=Integer.getMaxIntegerValue(4),MaxInteger_5Byte=Integer.getMaxIntegerValue(5),MaxInteger_6Byte=Integer.getMaxIntegerValue(6),MaxInteger_7Byte=Integer.getMaxIntegerValue(7),MaxInteger_8Byte=Integer.getMaxIntegerValue(8),import_util=__toESM(require("util")),String_default=class{static getStringByteLength(e){let t=0,r=0;for(let n=0;n<e.length;n++){const a=Integer_default.getIntegerByteLength(e.charCodeAt(n),!1);a!==r&&(r=a,t++),t+=a}return t}static writeString(e,t,r){let n=0;for(let a=0;a<r.length;a++){const g=r.charCodeAt(a),o=Integer_default.getIntegerByteLength(g,!1);o!==n&&(n=o,Integer_default.writeInteger(e,t,-o,1),t++),Integer_default.writeInteger(e,t,g,n),t+=n}}static readString(e,t,r){let n="",a=0;for(;t<r;){const r=Integer_default.readInteger(e,t,1);r<0?(a=-r,t++):(n+=String.fromCharCode(Integer_default.readInteger(e,t,a)),t+=a)}return n}static stringToBytes(e,t){const r=new Uint8Array(t);let n=0,a=0;for(let t=0;t<e.length;t++){const g=e.charCodeAt(t),o=Integer_default.getIntegerByteLength(g,!1);o!==n&&(n=o,Integer_default.writeInteger(r,a,o,1),a++),Integer_default.writeInteger(r,a,g,n),a+=n}return r}};(e=>{let t;var r;let n;var a;(r=t=e.TypesID||(e.TypesID={}))[r.Null=0]="Null",r[r.Undefined=1]="Undefined",r[r.Boolean=2]="Boolean",r[r.Integer=3]="Integer",r[r.Float=4]="Float",r[r.String=5]="String",r[r.Array=6]="Array",r[r.Uint8Array=7]="Uint8Array",r[r.Uint16Array=8]="Uint16Array",r[r.Uint32Array=9]="Uint32Array",r[r.Object=11]="Object",r[r.Map=12]="Map",r[r.Set=13]="Set",r[r.Function=14]="Function",(a=n=e.Types||(e.Types={})).NullType={id:0,getBodyLength:()=>0,writeBody:()=>{},readBody:()=>null},a.UndefinedType={id:1,getBodyLength:()=>0,writeBody:()=>{},readBody:()=>{}},a.BooleanType={id:2,getBodyLength:()=>1,writeBody:(e,t,r)=>e[t]=r?1:0,readBody:(e,t)=>1===e[t]},a.IntegerType={id:3,getBodyLength:e=>Integer_default.getIntegerByteLength(e<0?-e:e,e<0),writeBody:(e,t,r,n)=>Integer_default.writeInteger(e,t,r,n),readBody:(e,t,r)=>Integer_default.readInteger(e,t,r-t)},a.StringType={id:5,getBodyLength:e=>String_default.getStringByteLength(e),writeBody:(e,t,r)=>String_default.writeString(e,t,r),readBody:(e,t,r)=>String_default.readString(e,t,r)},a.ArrayType={id:6,getBodyLength:e=>{let t=0;for(let r=0;r<e.length;r++)t+=Fragment_default.getFragmentLength(e[r]);return t},writeBody:(e,t,r)=>r.forEach((r=>t=Fragment_default.writeFragment(e,t,r))),readBody:(e,t,r)=>{let n=new Array;for(;t<r;){const r=Fragment_default.readFragment(e,t);n.push(r.data),t=r.offset}return n}},a.Uint8ArrayType={id:7,getBodyLength:e=>e.length,writeBody:(e,t,r)=>e.set(r,t),readBody:(e,t,r)=>e.subarray(t,r)},a.Uint16ArrayType={id:8,getBodyLength:e=>2*e.length,writeBody:(e,t,r)=>{for(let n=0;n<r.length;n++)Integer_default.writeInteger(e,t,r[n],2),t+=2},readBody:(e,t,r)=>{const n=new Uint16Array((r-t)/2);for(let r=0;r<n.length;r++)n[r]=Integer_default.readInteger(e,t,2),t+=2;return n}},a.Uint32ArrayType={id:9,getBodyLength:e=>4*e.length,writeBody:(e,t,r)=>{for(let n=0;n<r.length;n++)Integer_default.writeInteger(e,t,r[n],42),t+=2},readBody:(e,t,r)=>{const n=new Uint32Array((r-t)/4);for(let r=0;r<n.length;r++)n[r]=Integer_default.readInteger(e,t,4),t+=2;return n}},a.ObjectType={id:11,getBodyLength:e=>{let t=0;for(let r of Object.keys(e))t+=Fragment_default.getFragmentLength(r)+Fragment_default.getFragmentLength(e[r]);return t},writeBody:(e,t,r)=>{for(let n of Object.keys(r))t=Fragment_default.writeFragment(e,t,n),t=Fragment_default.writeFragment(e,t,r[n])},readBody:(e,t,r)=>{const n={};for(;t<r;){const r=Fragment_default.readFragment(e,t);t=r.offset;const a=Fragment_default.readFragment(e,t);t=a.offset,n[r.data]=a.data}return n}},e.getDataTypeID=function(e){if(null===e)return 0;if(void 0===e)return 1;if("boolean"==typeof e)return 2;if("number"==typeof e&&!Number.isNaN(e))return Number.isInteger(e)?3:4;if("string"==typeof e)return 5;if(Array.isArray(e))return 6;if(e instanceof Uint8Array)return 7;if(e instanceof Uint16Array)return 8;if(e instanceof Object)return 11;throw new Error(`Unsupported Data Type: <${typeof e}> ([34m${import_util.default.inspect(e)}[0m)`)},e.getDataType=function(t){for(let r in e.Types)if(e.Types[r].id===t)return e.Types[r];throw new Error(`Data Type Not Found: ${t}`)}})(Data||(Data={}));var Data_default=Data,Fragment_default=class{static getFragmentLength(e){const t=Data_default.getDataTypeID(e),r=Data_default.getDataType(t).getBodyLength(e);return this.getHeaderLength(r)+r}static getHeaderLength(e){return 1+Integer_default.getIntegerByteLength(e,!1)}static writeFragment(e,t,r){const n=Data_default.getDataTypeID(r),a=Data_default.getDataType(n),g=a.getBodyLength(r);return t=this.writeHeader(e,t,{dataTypeID:n,bodyLength:g}),a.writeBody(e,t,r,g),t+g}static writeHeader(e,t,r){const n=Integer_default.getIntegerByteLength(r.bodyLength,!1);return e[t]=Integer_default.integersToByte(r.dataTypeID,n),Integer_default.writeInteger(e,t+1,r.bodyLength,n),t+(1+n)}static readFragment(e,t){const[r,n]=Integer_default.byteToIntegers(e[t]),a=Integer_default.readInteger(e,t+1,n);return{offset:(t+=1+n)+a,data:Data_default.getDataType(r).readBody(e,t,t+a)}}},API_default={save:e=>{const t=new Uint8Array(Fragment_default.getFragmentLength(e));return Fragment_default.writeFragment(t,0,e),t},load:e=>Fragment_default.readFragment(e,0).data};